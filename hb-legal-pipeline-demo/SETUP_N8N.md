# n8n Workflow Setup Instructions

## üìã Prerequisites
- n8n is running at http://localhost:5678
- You have the workflow file: `n8n-workflows/hb-legal-intelligence-pipeline.json`
- MCP server is running at http://localhost:3001

---

## Step 1: Access n8n Interface
1. **Open your browser** and navigate to: http://localhost:5678
2. **First-time setup**:
   - Enter any email address (e.g., `demo@hblegal.com`)
   - Create a password (e.g., `HBDemo2025!`)
   - Enter your first and last name
   - Click "Next"
3. **Skip optional steps**:
   - Skip the "Connect your app" step
   - Skip the "Customize n8n" step
   - Click "Get started"

---

## Step 2: Import the Workflow

### Method A: Import from File
1. Click **"Workflows"** in the left sidebar
2. Click the **"+"** button or **"Add workflow"**
3. Select **"Import from File"**
4. Browse to: `hb-legal-pipeline-demo/n8n-workflows/`
5. Select: `hb-legal-intelligence-pipeline.json`
6. Click **"Import"**

### Method B: Copy-Paste JSON
1. Open `hb-legal-intelligence-pipeline.json` in a text editor
2. Copy ALL the JSON content (Ctrl+A, Ctrl+C)
3. In n8n, click the **"+"** button
4. Press **Ctrl+V** to paste the workflow
5. The workflow will appear in the canvas

---

## Step 3: Configure the Webhook Node

### IMPORTANT: Get Your Unique Webhook URL

1. **Open the imported workflow** by clicking on it
2. **Find the webhook node**:
   - Look for the node labeled **"Document Intake"**
   - It's usually the first node (leftmost)
   - Has a webhook icon üîó
3. **Double-click** the "Document Intake" node
4. **Copy the webhook URL**:
   - You'll see a URL like: `http://localhost:5678/webhook/a1b2c3d4-e5f6-g7h8-i9j0-k1l2m3n4o5p6`
   - **‚ö†Ô∏è COPY THIS ENTIRE URL - You'll need it!**
   - Click the copy button next to the URL
5. **Save the URL** somewhere safe (notepad, etc.)
6. Click **"Done"** to close the node settings

---

## Step 4: Configure Credentials (If Using OpenAI)

### Skip this step if running in demo mode without AI

1. Click **"Credentials"** in the left sidebar
2. Click **"Add credential"**
3. Search for **"OpenAI"**
4. Add your OpenAI API key:
   - Name: `OpenAI API`
   - API Key: `sk-your-actual-api-key-here`
5. Click **"Create"**
6. Return to your workflow

---

## Step 5: Activate the Workflow

### ‚ö†Ô∏è CRITICAL: The workflow must be active to receive webhooks!

1. **Open your workflow** if not already open
2. Look at the **top-right corner** of the screen
3. Find the **toggle switch** labeled "Inactive/Active"
4. **Click the toggle** to switch it to **"Active"**
   - The switch should turn green/blue
   - You should see "Active" status
5. **Save the workflow**:
   - Click the **"Save"** button (top-right)
   - Or press **Ctrl+S**

---

## Step 6: Update Test Scripts with Your Webhook URL

### For Windows (test-webhook.bat):

1. Open `n8n-workflows/test-webhook.bat` in Notepad
2. Find the line:
   ```batch
   set WEBHOOK_URL=http://localhost:5678/webhook/legal-document
   ```
3. Replace with YOUR webhook URL:
   ```batch
   set WEBHOOK_URL=http://localhost:5678/webhook/a1b2c3d4-e5f6-g7h8-i9j0-k1l2m3n4o5p6
   ```
4. Save the file

### For Linux/Mac (test-webhook.sh):

1. Open `n8n-workflows/test-webhook.sh` in a text editor
2. Find the line:
   ```bash
   WEBHOOK_URL="http://localhost:5678/webhook/legal-document"
   ```
3. Replace with YOUR webhook URL:
   ```bash
   WEBHOOK_URL="http://localhost:5678/webhook/a1b2c3d4-e5f6-g7h8-i9j0-k1l2m3n4o5p6"
   ```
4. Save the file

---

## Step 7: Test Your Webhook

### Quick Test with cURL:
```bash
curl -X POST YOUR_WEBHOOK_URL_HERE \
  -H "Content-Type: application/json" \
  -d "{\"document\": \"Test legal document\", \"type\": \"deposition\", \"case_id\": \"TEST-001\"}"
```

### Using the Test Script:
```bash
cd n8n-workflows
test-webhook.bat
```

### Expected Response:
- You should receive: `{"message":"Workflow was started"}`
- Check n8n **"Executions"** tab to see the workflow run

---

## Step 8: Verify Execution

1. In n8n, click **"Executions"** in the left sidebar
2. You should see your test execution listed
3. Click on it to see details:
   - Green nodes = successful
   - Red nodes = errors
   - Click any node to see its input/output data

---

## üéØ Success Checklist

- [ ] n8n account created and logged in
- [ ] Workflow imported successfully
- [ ] Webhook URL copied and saved
- [ ] Workflow is **ACTIVE** (toggle is ON)
- [ ] Test webhook returns success message
- [ ] Execution visible in n8n Executions tab
- [ ] MCP server receiving metrics (check http://localhost:3001)

---

## üìù Important Notes

### Webhook URL Structure
Your webhook URL will look like:
```
http://localhost:5678/webhook/[unique-identifier]
```
Where `[unique-identifier]` is automatically generated by n8n.

### Common Webhook URLs (Examples)
- ‚ùå WRONG: `http://localhost:5678/webhook/legal-document`
- ‚ùå WRONG: `http://localhost:5678/webhook`
- ‚úÖ RIGHT: `http://localhost:5678/webhook/a1b2c3d4-e5f6-g7h8-i9j0-k1l2m3n4o5p6`

### Workflow Must Be Active
- **Inactive workflows will NOT receive webhooks**
- Always check the Active toggle before testing
- The workflow saves automatically when toggled

---

## üîÑ Quick Reset

If something goes wrong:

1. **Delete the workflow**:
   - Open the workflow
   - Click the menu (‚ãÆ) ‚Üí Delete
2. **Re-import** the workflow JSON
3. **Re-activate** the workflow
4. **Get the new webhook URL**
5. **Update your test scripts**

---

## üìû Next Steps

Once your webhook is working:

1. **Process real documents** by sending them to the webhook
2. **Monitor metrics** at http://localhost:3001
3. **View the dashboard** at http://localhost:8080
4. **Check executions** in n8n for detailed logs
5. **Customize the workflow** for your specific needs

---

## üéâ Congratulations!

Your n8n workflow is now configured and ready to process legal documents with AI!

- Webhook URL: `[Your unique URL]`
- Processing time: ~2 minutes per document
- Cost savings: $435 per document
- Accuracy: 95.8%

For troubleshooting, see `TROUBLESHOOTING.md`